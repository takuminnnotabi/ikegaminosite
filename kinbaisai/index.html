<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Press 3 to Play (Direct MP3)</title>
  <style>
    :root { --bg:#0b1020; --card:#141a2d; --text:#e6ebff; --muted:#9aa7c7; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans JP";background:radial-gradient(1200px 800px at 20% 10%,#17203a 0%,var(--bg) 60%);color:var(--text);display:grid;place-items:center}
    .wrap{width:min(760px,92vw);background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:24px 22px;box-shadow:0 20px 60px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,255,255,.04)}
    h1{margin:0 0 8px;font-size:clamp(20px,3vw,26px)} p{margin:6px 0;color:var(--muted)}
    .kbd{display:inline-grid;place-items:center;min-width:44px;height:44px;padding:0 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));box-shadow:0 6px 18px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.08);color:var(--text);font-weight:700;cursor:pointer;user-select:none;margin-right:8px}
    .row{display:flex;align-items:center;gap:10px;margin:14px 0 6px;flex-wrap:wrap}
    .status{margin-top:10px;color:#c7d6ff}
    details{margin-top:10px} code{background:rgba(255,255,255,.06);padding:2px 6px;border-radius:6px}
    .controls{margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    button{appearance:none;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);color:var(--text);cursor:pointer}
    audio{width:100%;display:none;margin-top:10px} audio.show{display:block}
    .links{margin-top:8px;font-size:14px}
    .links a{color:#cfe0ff}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>キーボードの <span class="kbd" id="btn3" title="クリックでもOK">3</span> で再生（poibus.com 直リンク版）</h1>
    <p>指定の MP3 を読み込み、<strong>3 キー</strong>を押すたびに <strong>先頭から再生</strong>します。</p>

    <div class="controls">
      <button id="toggleControls" aria-pressed="false">再生バーを表示</button>
      <button id="stopBtn">停止</button>
    </div>

    <div class="status" id="status">⌨️ 3 を押すと再生（クリックでも可）</div>

    <!-- プレイヤー -->
    <audio id="player" preload="none" crossorigin="anonymous" playsinline></audio>

    <div class="links" id="links"></div>

    <details>
      <summary>再生できない場合のチェック</summary>
      <ol>
        <li>下の <strong>テストリンク</strong> を新規タブで開き、直接再生/ダウンロードできるか確認。</li>
        <li>サーバーが正しい MIME タイプを返しているか（<code>Content-Type: audio/mpeg</code>）。Apacheなら <code>AddType audio/mpeg .mp3</code>。</li>
        <li>シークを滑らかにするには <code>Accept-Ranges: bytes</code> を返す設定に。</li>
      </ol>
    </details>
  </main>

  <script>
    (function(){
      // ご指定のURL（パーセントエンコード済み）
      const AUDIO_URL = "https://poibus.com/kinbaisai/1.mp3";

      const audio = document.getElementById('player');
      const status = document.getElementById('status');
      const btn3 = document.getElementById('btn3');
      const toggleControls = document.getElementById('toggleControls');
      const stopBtn = document.getElementById('stopBtn');
      const links = document.getElementById('links');

      // テストリンクを表示
      links.innerHTML = `テストリンク：<a href="${AUDIO_URL}" target="_blank" rel="noopener">開く</a>`;

      function setStatus(t){ status.textContent = t; }
      function ensureSrc(){ if (!audio.src) { audio.src = AUDIO_URL; audio.load(); } }

      async function playFromStart(){
        ensureSrc();
        try{
          audio.currentTime = 0;
          await audio.play();
          setStatus('▶️ 再生中… 3 を押すたびに先頭から再生します');
        }catch(err){
          console.error('play error', err);
          setStatus('⚠️ 再生エラー。上のテストリンクで直接開けるか／サーバーのMIME設定を確認してください。');
        }
      }

      function stop(){ try{ audio.pause(); audio.currentTime = 0; }catch(e){} setStatus('⏹ 停止。3 で再生できます'); }

      audio.addEventListener('error', () => setStatus('❌ 読み込み失敗。URLまたはサーバー設定を確認してください。'));
      audio.addEventListener('ended', () => setStatus('⏸ 再生完了。3 で頭からもう一度再生'));

      window.addEventListener('keydown', (e) => {
        if (e.key === '3' || e.code === 'Digit3' || e.code === 'Numpad3') { e.preventDefault(); playFromStart(); }
      }, {passive:false});

      btn3.addEventListener('click', playFromStart);
      stopBtn.addEventListener('click', stop);

      toggleControls.addEventListener('click', () => {
        const showing = audio.classList.toggle('show');
        toggleControls.setAttribute('aria-pressed', showing ? 'true' : 'false');
        toggleControls.textContent = showing ? '再生バーを隠す' : '再生バーを表示';
      });
    })();
  </script>
</body>
</html>
